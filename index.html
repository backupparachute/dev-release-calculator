<!DOCTYPE html>
<html>
	<head>
		<title>
			BPS Dev Release Calculator
		</title>
	    <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://cdn.usefathom.com/script.js" data-site="EABOZEKF" defer></script>
<!-- / Fathom -->

<!-- bump for updates -->
<!-- another bump, more bumps, moar bumps -->

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

		<link rel="stylesheet" href="https://backupparachute.com/css/tools.css">
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

		<style media="screen"></style>
	</head>
	<body class="calc-body">

		<div class="jumbotron jumbotron-fluid">

		  <div class="container">
				<div class="row">

					<div class="col text-center mt-md-1 mt-3">
				    <h1 class="bold-header-4 display-4">Dev Release Calculator</h1>
					</div>

				</div>
		  </div>
		</div>

		<div class="container">

			<div class="row">
				<div class="col text-center">
				    <p class="lead">How Often Do You Ship?</p>
						<p>Calculate your deployment frequency and see how your team stacks up.</p>
				</div>
			</div>

			<div class="row mt-3">
				<div class="col-md-6">

					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title">Project Metrics</h5>
			
							<form id="calcForm">
								<div class="form-group mb-3 mt-3">
									<label for="current_build_number">Current Build Number</label>
									<input class="form-control" type="number" name="current_build_number" min="1" id="current_build_number" required>
								</div>
								<div class="form-group mb-3 mt-3">
									<label for="current-day-year">
										Current Day of Year
										<span data-bs-toggle="tooltip" data-bs-placement="right" title="Today is day X of the year. You can change this if you're calculating for a different date.">
											<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle ms-1" viewBox="0 0 16 16">
												<path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
												<path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.02-.598.07-.165.12-.365.166-.575l.088-.416c.073-.34.183-.466.49-.511l.088-.012.082-.38-2.29.287-.088-.38zm-.81-2.29c-.282 0-.51.216-.51.482 0 .267.228.483.51.483.283 0 .51-.216.51-.483 0-.266-.227-.482-.51-.482z"/>
											</svg>
										</span>
									</label>
									<input class="form-control" type="number" name="current-day-year" min="1" id="current-day-year" required>
								</div>
							
								<div class="text-end mt-3">
									<button class="btn btn-primary" id="calcButton" type="submit" disabled>Calculate</button>
								</div>
							</form>
						</div>
					</div>

					<!-- <div class="card mb-3 d-none text-center" id="resultSection" style="--bs-bg-opacity: .2;">
						<div class="card-body">
							<h3 class="card-title">üìà Your Deployment Frequency</h3>
			
							<p class="fs-4" id="calcOutput"></p>
							<div id="interpretation" class="mt-4"></div>
			
						</div>
					</div> -->
			
					<div class="card mb-3 text-center" id="chartSection">
						<div class="card-body">
							<!-- <h3 class="card-title">üìà Deployment Frequency Trend</h3> -->
							<h3 class="card-title">üìà Your Deployment Frequency</h3>

							<p class="fs-4" id="calcOutput"></p>
							<div id="interpretation" class="mt-4"></div>

							<canvas id="deployChart" height="150" class="my-4"></canvas>
	
							<small class="text-muted">Tracking your last 10 release intervals</small>
							<button class="btn btn-outline-danger btn-sm" onclick="clearDeployHistory()">Clear Chart History</button>
			
						</div>
					</div>

				</div>
			
				<div class="col-md-6">
			
					<!-- <div class="card bg-info mb-3" style="--bs-bg-opacity: .3;">
						<div class="card-body">
							<h5 class="card-title">Average Days Per Build
							</h5>
			
							<input class="form-control" type="text" name="average-days-per-build" value="" id="average-days-per-build"
								class="mb-3" readonly>
			
						</div>
					</div> -->

					<div class="card mb-3">
						<div class="card-body">
							<h5 class="card-title">Deployment Cadence Benchmarks</h5>
			
							<table class="table table-bordered text-center">
								<thead class="table-light">
									<tr>
										<th>Avg Days Between Deploys</th>
										<th>Category</th>
										<th>Description</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>&lt; 2</td>
										<td>üß† Elite DevOps</td>
										<td>Deploy on merge, high test coverage</td>
									</tr>
									<tr>
										<td>2‚Äì4</td>
										<td>üöÄ High-Velocity Agile</td>
										<td>Strong CI/CD, mid-sprint releases</td>
									</tr>
									<tr>
										<td>4‚Äì7</td>
										<td>üß™ Healthy Iteration</td>
										<td>Weekly deploy rhythm</td>
									</tr>
									<tr>
										<td>7‚Äì14</td>
										<td>üì¶ Batch Deployment</td>
										<td>Manual QA or release gates</td>
									</tr>
									<tr>
										<td>&gt; 14</td>
										<td>üêå Traditional Cadence</td>
										<td>Waterfall or enterprise approval cycles</td>
									</tr>
								</tbody>
							</table>
			
			
						</div>
					</div>

	
			
				</div>
			
			
			</div>

			<div id="footer" class="row mt-5">

					<div class="copyright col">
			      &copy;<span id="copyright_year"></span> Backup Parachute Software LLC
			    </div>

				</div>

	</div> <!-- end container -->

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<!-- <script src="javascript/calc.js" type="text/javascript"></script> -->
<script src="https://backupparachute.com/scripts/copyright.js" type="text/javascript"></script>
<script src="https://backupparachute.com/scripts/tool_nav.js" type="text/javascript" data-campaign="dev-release-calculator"></script>
<script src="https://backupparachute.com/scripts/ads.js" type="text/javascript" data-campaign="app-ad"></script>


<script type="text/javascript">

let chartInstance = null;

document.addEventListener("DOMContentLoaded", function(){
// Handler when the DOM is fully loaded
const version = "v1.25.4.2"
console.log("loading event listenr: "+version+" ....");
setupTooltips()

const tooltip = document.querySelector('[data-bs-toggle="tooltip"]');
const today = Math.floor(daysIntoYear(new Date()));
if (tooltip) {
  tooltip.setAttribute("title", `Today is day ${today} of the year. You can change this if you're calculating for a different date.`);
  new bootstrap.Tooltip(tooltip);
}

const dayInput = document.getElementById("current-day-year");
if (!dayInput.value) dayInput.value = today;

const form = document.getElementById("calcForm");
const button = document.getElementById("calcButton");

// Revalidate inputs and toggle button
form.addEventListener("input", function () {
  const build = parseInt(document.getElementById("current_build_number").value);
  const day = parseInt(document.getElementById("current-day-year").value);
  const isValid = build > 0 && day > 0;
  button.disabled = !isValid;
});

// Submit handler (triggered by button or Enter key)
form.addEventListener("submit", function (e) {
  e.preventDefault(); // prevent reload
  calcTotals();
});

// const dayOfYearInput = document.getElementById('current-day-year');
// if (dayOfYearInput && !dayOfYearInput.value) {
//   const today = daysIntoYear(new Date());
//   dayOfYearInput.value = Math.floor(today); // Avoid decimals
// }

// document.querySelectorAll('input').forEach(item => {
// 	item.addEventListener('blur', event => {
// 	calcTotals(event);
// 	})
// })

let searchParams = new URLSearchParams(window.location.search);
let cbn = searchParams.get('curr_build_num') || searchParams.get('cbn');

console.log("found cbn param: "+cbn);
// bump for pages

if (cbn) {
	cbn = Number(cbn);
	console.log("setting cbn = "+cbn);
	document.querySelector('#current_build_number').value = cbn;
}

calcTotals();

renderChart();

});

function setupTooltips() {
	const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
	tooltipTriggerList.forEach(function (tooltipTriggerEl) {
		new bootstrap.Tooltip(tooltipTriggerEl);
	});

	// Set the actual day of year in tooltip title
	const today = Math.floor(daysIntoYear(new Date()));
	const tooltipEl = document.querySelector('[data-bs-toggle="tooltip"]');
	if (tooltipEl) {
		tooltipEl.setAttribute('title', `Today is day ${today} of the year. You can change this if you're calculating for a different date.`);
	}
}

function renderChart() {
  const history = JSON.parse(localStorage.getItem('deployHistory'));
  console.log("Chart history loaded:", history);

  if (!history || history.length === 0) {
    console.log("No chart history to render.");
    return;
  }

  const chartSection = document.getElementById('chartSection');
  if (chartSection) chartSection.classList.remove("d-none");

  const labels = history.map((item, idx) =>
    `#${history.length - idx}: ${item.deploys} in ${item.days}d`
  );
  const data = history.map(item => parseFloat(item.average));

  const ctx = document.getElementById('deployChart').getContext('2d');

  // Destroy existing chart if it exists
  if (chartInstance !== null) {
    chartInstance.destroy();
  }

  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels.reverse(),
      datasets: [{
        label: 'Avg Days per Deploy',
        data: data.reverse(),
        borderColor: 'rgba(54, 162, 235, 1)',
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        fill: true,
        tension: 0.3,
        pointRadius: 5
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Days Between Deploys' }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: { mode: 'index' }
      }
    }
  });
}


function clearDeployHistory() {
  localStorage.removeItem('deployHistory');
  location.reload();
}


function calcTotals(event) {
	console.log("calc totals...");

	const resultSection = document.getElementById("resultSection");

	let curr_build_number = Number(document.querySelector('#current_build_number').value);

	// let day = daysIntoYear(new Date());
	let day = Number(document.querySelector('#current-day-year').value);

	let avg_days_per_build = day / curr_build_number;

	const output = document.getElementById("calcOutput");
	const interp = document.getElementById("interpretation");


	document.querySelector('#current-day-year').value = day;
	// if (Number.isFinite(avg_days_per_build)) {
		// document.querySelector('#average-days-per-build').value = avg_days_per_build.toFixed(2);
	// }

	if (curr_build_number <= 0 || day <= 0) {
		// output.textContent = "Please enter valid numbers.";
		resultSection.classList.remove("d-none");
		return;
	}

	// output.textContent = `${avg_days_per_build.toFixed(2)} days per deploy`;
	if (Number.isFinite(avg_days_per_build)) {
		// document.querySelector('#average-days-per-build').value = avg_days_per_build.toFixed(2);
		output.textContent = `${avg_days_per_build.toFixed(2)} days per deploy`;
	}

	let category = "", explanation = "";

	if (avg_days_per_build < 2) {
		category = "üß† Elite DevOps";
		explanation = "You‚Äôre deploying on merge with high confidence‚Äîworld-class velocity.";
	} else if (avg_days_per_build < 4) {
		category = "üöÄ High-Velocity Agile";
		explanation = "You ship fast and often. Great CI/CD maturity.";
	} else if (avg_days_per_build < 7) {
		category = "üß™ Healthy Iteration";
		explanation = "Weekly releases are solid‚Äîbut you might be able to go faster.";
	} else if (avg_days_per_build < 14) {
		category = "üì¶ Batch Deployment";
		explanation = "Manual steps or approval gates might be slowing you down.";
	} else {
		category = "üêå Traditional Cadence";
		explanation = "You‚Äôre shipping less frequently. Consider breaking up changes or automating deploys.";
	}

	interp.innerHTML = `
		<h5 class="mt-3">${category}</h5>
		<p>${explanation}</p>
	`;

	resultSection.classList.remove("d-none");

	// After calculating 'avg'
const lastCalc = {
  deploys: curr_build_number,
  days: day,
  average: avg_days_per_build.toFixed(2)
};

// localStorage.setItem('lastDeployCalc', JSON.stringify(lastCalc));
const previous = JSON.parse(localStorage.getItem('deployHistory')) || [];
previous.unshift(lastCalc); // Add to the beginning of the list
const maxItems = 10;
if (previous.length > maxItems) previous.pop(); // Keep only 10 entries

localStorage.setItem('deployHistory', JSON.stringify(previous));

renderChart(); // üîÅ Force chart update with the new data point


}

function to_percent(num) {
if (num) {
	return 	(num / 100);
}

return 0;

}

function daysIntoYear(date){
return (Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()) - Date.UTC(date.getFullYear(), 0, 0)) / 24 / 60 / 60 / 1000;
}

function to_currency(num) {
const formatter = new Intl.NumberFormat('en-US', {
	style: 'currency',
	currency: 'USD',
	minimumFractionDigits: 2
});
return formatter.format(num);
}

</script>

	</body>
</html>
